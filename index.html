<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="jquery.timeago.js" type="text/javascript"></script>
    <script src="data_generator.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/skeleton/2.0.4/skeleton.min.css">
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css?family=Raleway:300,400,600" rel="stylesheet">
    <title>Twittler (Testing)</title>
  </head>
  <body>

    <div class="container">
      <div class="row">
        <header> <!-- Hero Section -->
          <h1 class="hero">Twittler</h1>      
          <p class="tagline">A small web-application that utilizes HTML, CSS, and JavaScript.</p>
          <p class="descriptor">Twittler displays computer generated tweets from a few users and displays them. To see an individual user's tweets, just click on the tweeters username.</p>
        </header>
      </div>
      <div class="row center-me">
        <navigation> <!-- Navigation Section -->
          <button type='button' class="button-primary refresh-tweets">Refresh</button>
        </navigation>
      </div>

      <div class="row">
        <!-- <section class="live-tweets u-full-width">
        </section> -->
        <table class="u-full-width">
          <thead>
            <th>User</th>
            <th>Message</th>
            <th>Tweeted</th>
          </thead>
          <tbody class="live-tweets">
          </tbody>
        </table>
      </div>

      <footer> <!-- Footer & Credits Section -->
        <p>By Jon Eric Escobedo for Hack Reactor, 2017</p>
      </footer>
    </div>

    <script>
      function getTweets(userTweets) {
        var $body = $('.live-tweets');
        var index = userTweets.length - 1;
        var maxTweets = 0;
        $body.html('');

        while(index >= 0 && maxTweets < 500){
          var tweet = userTweets[index];
          var $tweet = $('<tr><td class="user"></td><td class="user-message"></td><td class="created"></td></tr>');
          var getTime = jQuery.timeago(tweet.created_at); 

          $tweet.children('.user').text('@' + tweet.user);
          $tweet.children('.user-message').text(tweet.message);
          $tweet.children('.created').text(' ' + getTime);
          $tweet.appendTo($body);

          index -= 1;
          maxTweets++;
        }
      }

      $(document).ready(function(){
        getTweets(streams.home);

        $('.refresh-tweets').on('click', function() {
          getTweets(streams.home);
          $('.refresh-tweets').text('refresh');
        });

        $('.live-tweets').on('click', '.user', function() {
          var currentUser = $(this).text().slice(1);
          getTweets(streams.users[currentUser]);
          $('.refresh-tweets').text('all streams');
        });
      });

    </script>
    
  </body>
</html>